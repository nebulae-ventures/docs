"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[502],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return h}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),u=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=u(e.components);return a.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,s=e.originalType,l=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),d=u(n),h=r,m=d["".concat(l,".").concat(h)]||d[h]||p[h]||s;return n?a.createElement(m,o(o({ref:t},c),{},{components:n})):a.createElement(m,o({ref:t},c))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var s=n.length,o=new Array(s);o[0]=d;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:r,o[1]=i;for(var u=2;u<s;u++)o[u]=n[u];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},8561:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return i},contentTitle:function(){return l},metadata:function(){return u},toc:function(){return c},default:function(){return d}});var a=n(7462),r=n(3366),s=(n(7294),n(3905)),o=["components"],i={},l="Introduction \xe0 Hardhat",u={unversionedId:"dev/smart-contracts/introduction-a-hardhat",id:"dev/smart-contracts/introduction-a-hardhat",title:"Introduction \xe0 Hardhat",description:"Dans cet article, nous allons introduire Hardhat et passer en revue ses principales",source:"@site/docs/dev/smart-contracts/introduction-a-hardhat.md",sourceDirName:"dev/smart-contracts",slug:"/dev/smart-contracts/introduction-a-hardhat",permalink:"/dev/smart-contracts/introduction-a-hardhat",tags:[],version:"current",frontMatter:{},sidebar:"mySidebar",previous:{title:"Outils de base",permalink:"/dev/smart-contracts/outils-de-base"},next:{title:"Subnet",permalink:"/concepts/subnet"}},c=[{value:"Hardhat ?",id:"hardhat-",children:[],level:2},{value:"Alternatives",id:"alternatives",children:[],level:2},{value:"Forces",id:"forces",children:[],level:2},{value:"Hardhat Network",id:"hardhat-network",children:[],level:2},{value:"Hardhat Runner",id:"hardhat-runner",children:[],level:2},{value:"Plugins",id:"plugins",children:[],level:2},{value:"Tests",id:"tests",children:[],level:2},{value:"Sources et liens",id:"sources-et-liens",children:[],level:2}],p={toc:c};function d(e){var t=e.components,n=(0,r.Z)(e,o);return(0,s.kt)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"introduction-\xe0-hardhat"},"Introduction \xe0 Hardhat"),(0,s.kt)("p",null,"Dans cet article, nous allons introduire ",(0,s.kt)("strong",{parentName:"p"},(0,s.kt)("a",{parentName:"strong",href:"https://hardhat.org/"},"Hardhat"))," et passer en revue ses principales\nfonctionnalit\xe9s. Elles feront l'objet d'articles/tutoriels plus d\xe9taill\xe9s dans le futur."),(0,s.kt)("h2",{id:"hardhat-"},"Hardhat ?"),(0,s.kt)("p",null,"Cr\xe9e par ",(0,s.kt)("a",{parentName:"p",href:"https://nomiclabs.io/"},"Nomic Labs"),", Hardhat est un environment de d\xe9veloppement pour les ",(0,s.kt)("strong",{parentName:"p"},"dApp")," tournant sur\nune ",(0,s.kt)("strong",{parentName:"p"},(0,s.kt)("a",{parentName:"strong",href:"https://ethereum.org/fr/developers/docs/evm/#top"},"EVM")),". Il vous aide \xe0 diverses \xe9tapes de votre travail telles\nque :"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"compilation du code Solidity"),(0,s.kt)("li",{parentName:"ul"},"d\xe9ploiement"),(0,s.kt)("li",{parentName:"ul"},"automatisation de t\xe2ches r\xe9currentes"),(0,s.kt)("li",{parentName:"ul"},"tests"),(0,s.kt)("li",{parentName:"ul"},"d\xe9bogage de votre smart contract")),(0,s.kt)("p",null,"Hardhat am\xe8ne sa propre version modifi\xe9e de l'EVM que vous pouvez utiliser lors de vos phases de tests. Cette\nEVM modifi\xe9e rajoute des aides utiles vous permettant de tester plus efficacement votre code."),(0,s.kt)("h2",{id:"alternatives"},"Alternatives"),(0,s.kt)("p",null,"Hardhat n'est pas le seul outil dans sa cat\xe9gorie, vous connaissez\npeut-\xeatre ",(0,s.kt)("strong",{parentName:"p"},(0,s.kt)("a",{parentName:"strong",href:"https://trufflesuite.com/docs/truffle/"},"Truffle")),"\nqui poss\xe8de des fonctionnalit\xe9s assez semblables."),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},(0,s.kt)("a",{parentName:"strong",href:"https://eth-brownie.readthedocs.io/en/stable/"},"Brownie"))," est un outil \xe9crit en python qui poss\xe8de des capacit\xe9s\nsimilaires \xe0 Truffle. Si vous \xeates plus \xe0 l'aise avec python alors cet outil est probablement un bon choix pour vous."),(0,s.kt)("p",null,"Il y a aussi ",(0,s.kt)("strong",{parentName:"p"},(0,s.kt)("a",{parentName:"strong",href:"https://mirror.xyz/sha.eth/6Mn3HjrqKLhHzu2balLPv4SqE5a-oEESl4ycpRkWFsc"},"Foundry"))," un nouveau venu sur la sc\xe8ne des outils de\nd\xe9veloppement web3. Il promet une plus\ngrande ",(0,s.kt)("a",{parentName:"p",href:"https://www.paradigm.xyz/2021/12/introducing-the-foundry-ethereum-development-toolbox/#You_should_be_writing_your_tests_in_Solidity"},"rapidit\xe9 d'ex\xe9cution des tests"),"\n. Ceci est surement d\xfb au fait que contrairement \xe0 Hardhat ou truffle, qui sont \xe9crit \xe0 l'aide de Javascript, Foundry\nutilise Rust."),(0,s.kt)("p",null,"Un dernier outil concurrent \xe0 Hardhat\xa0: ",(0,s.kt)("strong",{parentName:"p"},(0,s.kt)("a",{parentName:"strong",href:"https://dapp.tools/"},"dApp.tools")),"."),(0,s.kt)("p",null,"On fera peut-\xeatre une s\xe9rie d'articles allant plus en profondeur sur ces outils dans le futur."),(0,s.kt)("h2",{id:"forces"},"Forces"),(0,s.kt)("p",null,"Globalement, Hardhat est plus facile d'utilisation. La possibilit\xe9 de faire tourner ses tests en utilisant une copie\nde l'\xe9tat d'une blockchain, \xe0 un certain block, est tr\xe8s puissante. Permettant d'effectuer ses tests de mani\xe8re d\xe9terministe avec un\ntemps de mise en place moindre. Il est aussi plus rapide lors de l'ex\xe9cution\ndes tests que Truffle, cela peut vous faire gagner pas mal de temps."),(0,s.kt)("blockquote",null,(0,s.kt)("p",{parentName:"blockquote"},"\xc0 noter que Foundry met en avant le fait qu'il soit\n",(0,s.kt)("a",{parentName:"p",href:"(https://www.paradigm.xyz/2021/12/introducing-the-foundry-ethereum-development-toolbox/#You_should_be_writing_your_tests_in_Solidity)"},"plus rapide")," qu'Hardhat sur ce point.")),(0,s.kt)("p",null,"Le syst\xe8me de plugins est tr\xe8s int\xe9ressant et permet d'\xe9tendre les fonctionnalit\xe9s d'Hardhat. Par exemple, il existe un\nplugin qui calcul le cout de chaque transaction effectu\xe9 lors de vos tests. Un autre vous permettra d'automatiquement\nv\xe9rifier vos smart contracts sur ",(0,s.kt)("a",{parentName:"p",href:"https://etherscan.io/"},"etherscan")," ou\n",(0,s.kt)("a",{parentName:"p",href:"https://snowtrace.io/"},"snowtrace"),". Nous vous recommandons de jeter un coup d'\u0153il\n\xe0 ",(0,s.kt)("a",{parentName:"p",href:"https://hardhat.org/plugins/"},"cette page"),"."),(0,s.kt)("p",null,"Il semblerait qu'Hardhat soit l'outil, \xe0 ce jour, le plus complet et performant vous permettant de d\xe9velopper et tester votre\ncode Solidity."),(0,s.kt)("h2",{id:"hardhat-network"},"Hardhat Network"),(0,s.kt)("p",null,"Une des forces d'Hardhat est qu'il soit livr\xe9 avec ",(0,s.kt)("strong",{parentName:"p"},"Hardhat Network"),", une version modifi\xe9e de l'EVM. Cette\nversion incorpore des changements destin\xe9s \xe0 faciliter la vie des d\xe9veloppeurs web3, en rajoutant par exemple des\nmessages d'erreurs plus clairs lors de probl\xe8mes \xe0 l'ex\xe9cution de vos transactions. Rajoutant des stack traces\nmontrant pr\xe9cis\xe9ment o\xf9 celle-ci a rencontr\xe9 un probl\xe8me."),(0,s.kt)("p",null,"Voici un exemple de stack trace venant de la -au passage tr\xe8s\nbonne- ",(0,s.kt)("a",{parentName:"p",href:"https://hardhat.org/hardhat-network/"},"documentation")," d'Hardhat."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-shell"},"Error: Transaction reverted: function selector was not recognized and there's no fallback function\n  at ERC721Mock.<unrecognized-selector> (contracts/mocks/ERC721Mock.sol:9)\n  at ERC721Mock._checkOnERC721Received (contracts/token/ERC721/ERC721.sol:334)\n  at ERC721Mock._safeTransferFrom (contracts/token/ERC721/ERC721.sol:196)\n  at ERC721Mock.safeTransferFrom (contracts/token/ERC721/ERC721.sol:179)\n  at ERC721Mock.safeTransferFrom (contracts/token/ERC721/ERC721.sol:162)\n  at TruffleContract.safeTransferFrom (node_modules/@nomiclabs/truffle-contract/lib/execute.js:157:24)\n  at Context.<anonymous> (test/token/ERC721/ERC721.behavior.js:321:26)\n")),(0,s.kt)("p",null,"On voit ici que la stack trace montre clairement quel contract et \xe0 quelle ligne l'erreur est survenu. On peut aussi voir\nquel test l'a d\xe9clench\xe9."),(0,s.kt)("p",null,"Un autre rajout essentiel est celui du ",(0,s.kt)("inlineCode",{parentName:"p"},"console.log")," dans le code Solidity. Vous donnant la possibilit\xe9\nd'avoir un aper\xe7u de ce qui se passe dans votre code, vous aidant ainsi fortement dans votre processus de d\xe9veloppement\net de test."),(0,s.kt)("p",null,"Il est aussi possible de d\xe9marrer ",(0,s.kt)("strong",{parentName:"p"},"Hardhat Network Node")," via votre terminal et de l'utiliser comme client RPC pour des\napplications telles que Metamask, un bot que vous d\xe9veloppez ou n'importe quelle dApp (bien s\xfbr le r\xe9seau en d\xe9coulant\nsera un r\xe9seau destin\xe9 aux tests). Tr\xe8s utile pour des tests d'int\xe9gration en environnement contr\xf4l\xe9."),(0,s.kt)("p",null,"Il est int\xe9ressant de noter que par d\xe9faut ce r\xe9seau va miner un nouveau block \xe0 chaque transaction que vous allez\neffectuer dans vos tests. Ceci est ",(0,s.kt)("a",{parentName:"p",href:"https://hardhat.org/hardhat-network/explanation/mining-modes.html"},"enti\xe8rement configurable"),"."),(0,s.kt)("h2",{id:"hardhat-runner"},"Hardhat Runner"),(0,s.kt)("p",null,"C'est le CLI qui vous permettra d'int\xe9ragir avec Hardhat. Hardhat est orient\xe9 autours de tasks, chaque commande que vous\nlancerez sera en fait d\xe9finie par une task."),(0,s.kt)("p",null,"Voici un example de commande:"),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"npx hardhat test")),(0,s.kt)("p",null,"Il n'y a pas de pi\xe8ge et cette commande va juste lancer l'ex\xe9cution de tous les tests se trouvant dans votre dossier test."),(0,s.kt)("p",null,"Voici une liste des diff\xe9rentes tasks par 'default' :"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-shell"},"$ npx hardhat\nHardhat version 2.0.8\n\nUsage: hardhat [GLOBAL OPTIONS] <TASK> [TASK OPTIONS]\n\nGLOBAL OPTIONS:\n\n  --config              A Hardhat config file.\n  --emoji               Use emoji in messages.\n  --help                Shows this message, or a task's help if its name is provided\n  --max-memory          The maximum amount of memory that Hardhat can use.\n  --network             The network to connect to.\n  --show-stack-traces   Show stack traces.\n  --tsconfig            A TypeScript config file.\n  --verbose             Enables Hardhat verbose logging\n  --version             Shows hardhat's version.\n\n\nAVAILABLE TASKS:\n\n  accounts      Prints the list of accounts\n  check         Check whatever you need\n  clean         Clears the cache and deletes all artifacts\n  compile       Compiles the entire project, building all artifacts\n  console       Opens a hardhat console\n  flatten       Flattens and prints contracts and their dependencies\n  help          Prints this message\n  node          Starts a JSON-RPC server on top of Hardhat Network\n  run           Runs a user-defined script after compiling the project\n  test          Runs mocha tests\n\nTo get help for a specific task run: npx hardhat help [task]\n")),(0,s.kt)("h1",{id:"tasks"},"Tasks"),(0,s.kt)("p",null,"Lorsque vous lancez une commande depuis le runner, vous utilisez une task."),(0,s.kt)("p",null,"Dans la section pr\xe9c\xe9dente nous avons vu qu'avec le CLI on peut lancer l'ex\xe9cution de tasks. Celles-ci peuvent \xeatre\ncelles par d\xe9faut d'Hardhat telles que ",(0,s.kt)("inlineCode",{parentName:"p"},"test")," , ",(0,s.kt)("inlineCode",{parentName:"p"},"compile")," mais aussi des tasks que vous aurez d\xe9fini vous-m\xeame."),(0,s.kt)("p",null,"Ces tasks personnalis\xe9s sont \xe0 d\xe9finir dans le dossier ",(0,s.kt)("inlineCode",{parentName:"p"},"/scripts")," en Typescript (je vous encourage vraiment \xe0 prendre le\ntemps de setup Hardhat avec Typescript et de ne pas utiliser directement Javascript). Elles pourront\nensuite \xeatre ex\xe9cut\xe9es via la commande\n",(0,s.kt)("inlineCode",{parentName:"p"},"npx hardhat run nomdelacommande"),". Cela peut \xeatre tr\xe8s utile pour effectuer des t\xe2ches r\xe9currentes. Voici un exemple de\nworkflow possible :"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"cr\xe9ation d'un r\xe9seau hardhat network dans un terminal, bas\xe9 sur l'\xe9tat de la Cchain d'Avalanche \xe0 un block pr\xe9cis."),(0,s.kt)("li",{parentName:"ul"},"ex\xe9cution d'une task qui va envoyer des transactions \xe0 un smart contract d\xe9j\xe0 d\xe9ploy\xe9 sur la CChain,\npermettant ainsi de cr\xe9er un environnement de test contr\xf4l\xe9"),(0,s.kt)("li",{parentName:"ul"},"test de l'application, se connectant au r\xe9seau hardhat (par d\xe9faut le rpc il sera  disponible ici : ",(0,s.kt)("inlineCode",{parentName:"li"},"127.0.0.1:8545"),")")),(0,s.kt)("p",null,"Voici une d'une ",(0,s.kt)("inlineCode",{parentName:"p"},"task")," personnalis\xe9e, le fichier se nomme ",(0,s.kt)("inlineCode",{parentName:"p"},"check_price.ts"),". Cela va simplement appeler la\nfonction ",(0,s.kt)("inlineCode",{parentName:"p"},"getReserves")," de la paire Wavax-USDT.e de Trader Joe et calculer le prix actuel, en USDT.e, d'un WAVAX."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},'import { ethers } from "hardhat";\nimport * as dotenv from "dotenv";\nimport { BigNumber, Wallet } from "ethers";\n\nconst main = async (): Promise<any> => {\n\n    const tjWavaxUsdtePair = await ethers.getContractAt("IJoePair", "0xed8cbd9f0ce3c6986b22002f03c6475ceb7a6256");\n\n    let reserves = await tjWavaxUsdtePair.getReserves();\n\n    let wavaxDecimal = reserves[0].div(BigNumber.from("1000000000000000000")).toNumber()\n    let usdteDecimal = reserves[1].div(BigNumber.from("1000000")).toNumber()\n    let timestamp = reserves[2]\n\n    console.log("Price in TJ : " + usdteDecimal / wavaxDecimal);\n}\n\nmain()\n    .then(() => process.exit(0))\n    .catch(error => {\n        console.error(error)\n        process.exit(1)\n    })\n')),(0,s.kt)("p",null,"On peut lancer l'ex\xe9cution de cette task via ",(0,s.kt)("inlineCode",{parentName:"p"},"npx hardhat run check_price")),(0,s.kt)("h2",{id:"plugins"},"Plugins"),(0,s.kt)("p",null,"Comme mentionn\xe9 plus haut, une des forces d'Hardhat est sa modularit\xe9 et son extensibilit\xe9.\nLes plugins sont utilis\xe9s pour int\xe9grer \xe0 Hardhat les possibilit\xe9s d'autres librairies."),(0,s.kt)("p",null,'Il existe quelques plugins "officiels" et d\'autres fournit par la communaut\xe9.'),(0,s.kt)("p",null,"Certain permettent de ",(0,s.kt)("a",{parentName:"p",href:"https://hardhat.org/plugins/nomiclabs-hardhat-etherscan.html"},"v\xe9rifier facilement vos smart contracts sur etherscan"),"\nUn autre vous permet de voir le ",(0,s.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/solidity-coverage"},"code coverage")," actuel de votre code Solidity."),(0,s.kt)("h2",{id:"tests"},"Tests"),(0,s.kt)("p",null,"Hardhat facilite grandement le testage de vos smart contracts et si vous avez d\xe9j\xe0 utilis\xe9 ",(0,s.kt)("a",{parentName:"p",href:"https://mochajs.org/"},"Mocha"),'\npour un projet "web2" vous ne serez pas trop d\xe9pays\xe9s.'),(0,s.kt)("p",null,"Voici un aper\xe7u d'un test de smart contract avec Hardhat:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},'const { expect } = require("chai");\n\ndescribe("Token contract", function () {\n  it("Deployment should assign the total supply of tokens to the owner", async function () {\n    const [owner] = await ethers.getSigners();\n\n    const Token = await ethers.getContractFactory("Token");\n\n    const hardhatToken = await Token.deploy();\n\n    const ownerBalance = await hardhatToken.balanceOf(owner.address);\n    expect(await hardhatToken.totalSupply()).to.equal(ownerBalance);\n  });\n});\n')),(0,s.kt)("h2",{id:"sources-et-liens"},"Sources et liens"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://hardhat.org/plugins/nomiclabs-hardhat-web3.html"},"https://hardhat.org/plugins/nomiclabs-hardhat-web3.html")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://hardhat.org/tutorial/"},"https://hardhat.org/tutorial/")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://docs.avax.network/build/tutorials/tutorials-contest/hardhat-fork/"},"https://docs.avax.network/build/tutorials/tutorials-contest/hardhat-fork/")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://moralis.io/hardhat-explained-what-is-hardhat/"},"https://moralis.io/hardhat-explained-what-is-hardhat/")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://dev.to/yakult/a-concise-hardhat-tutorial-part-1-7eo"},"https://dev.to/yakult/a-concise-hardhat-tutorial-part-1-7eo"))))}d.isMDXComponent=!0}}]);